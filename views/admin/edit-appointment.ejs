<%- include('../partials/header') %>
<%- include('../partials/navbar') %>

<div class="container" style="padding:32px;">
  <a href="/admin/dashboard" class="btn-secondary" style="margin-bottom:16px; display:inline-block;">‚Üê Back to dashboard</a>

  <h1>Edit Appointment</h1>

  <% if (error && error.length > 0) { %>
    <div class="alert alert-error"><%= error %></div>
  <% } %>
  <% if (success && success.length > 0) { %>
    <div class="alert alert-success"><%= success %></div>
  <% } %>

  <form action="/admin/appointments/<%= appointment._id %>/edit" method="POST" class="edit-form" style="max-width:720px;">
    <div class="form-group">
      <label for="customerName">Customer Name</label>
      <input id="customerName" name="customerName" required value="<%= appointment.customerName || '' %>">
    </div>

    <div class="form-group">
      <label for="customerEmail">Email</label>
      <input id="customerEmail" name="customerEmail" type="email" required value="<%= appointment.customerEmail || '' %>">
    </div>

    <div class="form-group">
      <label for="customerPhone">Phone</label>
      <input id="customerPhone" name="customerPhone" required value="<%= appointment.customerPhone || '' %>">
    </div>

    <div class="form-group">
      <label for="barber">Barber</label>
      <select id="barber" name="barber" required>
        <% barbers.forEach(b => { %>
          <option value="<%= b._id %>" <%= appointment.barber && (appointment.barber.toString ? appointment.barber.toString() : appointment.barber) === b._id.toString() ? 'selected' : '' %> >
            <%= b.name %> <%= b.specialty ? '- ' + b.specialty : '' %>
          </option>
        <% }) %>
      </select>
    </div>

    <div class="form-group">
      <label for="service">Service</label>
      <input id="service" name="service" required value="<%= appointment.service || '' %>">
    </div>

    <div class="form-group">
      <label for="date">Date</label>
      <input id="date" name="date" type="date" required
        value="<%= appointment.date ? (new Date(appointment.date)).toISOString().split('T')[0] : '' %>">
    </div>

    <div class="form-group">
      <label for="time">Time</label>
      <select id="time" name="time" required>
        <% const start = 9, end = 20;
           for (let h = start; h <= end; h++) {
             const hr = h.toString().padStart(2,'0');
        %>
          <option value="<%= hr %>:00" <%= appointment.time === (hr + ':00') ? 'selected' : '' %>><%= hr %>:00</option>
          <option value="<%= hr %>:30" <%= appointment.time === (hr + ':30') ? 'selected' : '' %>><%= hr %>:30</option>
        <% } %>
      </select>
    </div>

    <div class="form-group">
      <label for="notes">Notes</label>
      <textarea id="notes" name="notes" rows="3"><%= appointment.notes || '' %></textarea>
    </div>

    <button type="submit" class="btn-primary">Save changes</button>
  </form>
</div>

<%- include('../partials/footer') %>
